// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id             Int      @id @default(autoincrement())
  username       String   @unique
  name           String
  email          String?  @unique
  password       String?
  contact_number String?
  account_type   String?
  bio            String?
  profile_picture String?
  cover_image    String?
  status         String   @default("active") // active, warned, suspended, banned
  moreInfo       String?  // JSON: { suspensionCount, suspendedUntil, warnings: [] }
  created_on     DateTime @default(now())
  updated_at     DateTime @updatedAt

  kyc            KYC?
  
  // Relations
  listedProperties    Property[] @relation("ListedBy")
  ownedProperties     Property[] @relation("Owner")
  authorizedProperties Property[] @relation("AuthorizedPerson")
  
  comments       Comment[]
  user_likes     Like[]
  collections    Collection[]
  requirements   Requirement[]
}

model KYC {
  id             Int      @id @default(autoincrement())
  userId         Int      @unique
  user           User     @relation(fields: [userId], references: [id])
  name           String
  email          String
  phone          String
  // Additional KYC fields
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt
}

model Property {
  id                      Int      @id @default(autoincrement())
  propertyId              String?  @unique // if unfilled (same as the id) - logic in app
  
  // Relations for multi-selection
  types                  PropertyType[]
  purposes               PropertyPurpose[]
  natures                PropertyNature[]

  // Listing Data
  isPrivate               Boolean  @default(false)
  status                  String   @default("pending") // approved, pending, rejected, warned
  soldStatus              String   @default("unsold")  // soldByUs, soldByOther, unsold
  isFeatured              Boolean  @default(false)
  isExclusive             Boolean  @default(false)
  isVerified              Boolean  @default(false)
  remarks                 String?

  // Road and Entrance
  roadType               String?
  roadSize               String?
  facingDirection        String?

  // Location Information
  location               PropertyLocation?
  
  // Pricing Details
  pricing                PropertyPricing?

  // Open House
  openHouse              PropertyOpenHouse?

  // Specific Features (varying by property type)
  features               PropertyFeatures?

  // Relations
  images                 PropertyImage[]
  videos                 PropertyVideo[]
  amenities              PropertyAmenity[]

  // Ownership Details
  listedById             Int
  listedBy               User     @relation("ListedBy", fields: [listedById], references: [id])
  
  ownerId                Int
  owner                  User     @relation("Owner", fields: [ownerId], references: [id])
  
  authorizedPersonId     Int?
  authorizedPerson       User?    @relation("AuthorizedPerson", fields: [authorizedPersonId], references: [id])

  // Core metadata
  title                  String
  slug                   String?
  created_on             DateTime @default(now())
  updated_at             DateTime @updatedAt

  // Interactive
  views                  Int      @default(0)
  shares                 Int      @default(0)
  comments               Comment[]
  property_likes         Like[]
  featured_history       FeaturedInformation[]
  collections            CollectionProperty[]
}

model PropertyType {
  id          Int        @id @default(autoincrement())
  name        String     @unique // house, bungalow, land, apartment, commercial space, villa, penthouse
  properties  Property[]
}

model PropertyPurpose {
  id          Int        @id @default(autoincrement())
  name        String     @unique // sale, rent
  properties  Property[]
}

model PropertyNature {
  id          Int        @id @default(autoincrement())
  name        String     @unique // commercial, semi commercial, residential, agricultural, industrial
  properties  Property[]
}


model PropertyFeatures {
  id               Int      @id @default(autoincrement())
  propertyId       Int      @unique
  property         Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  // Residential/Building (House, Apartment)
  bedrooms         Int?
  bathrooms        Int?
  kitchens         Int?
  livingRooms      Int?
  floorNumber      Int?
  totalFloors      Int?
  furnishing       String? // Unfurnished, Semi-furnished, Full-furnished
  
  // Size/Area details (Additional to Pricing)
  builtUpArea      Float?
  builtUpAreaUnit  String? // sqft, sqm, aana, ropani
  
  // Commercial/Space specific
  parkingAvailable Boolean?
  elevator         Boolean?
  security         Boolean?
  waterSupply      Boolean?
  electricity      Boolean?
}


model PropertyLocation {
  id               Int      @id @default(autoincrement())
  propertyId       Int      @unique
  property         Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  
  latitude         Float?
  longitude        Float?
  country          String   @default("Nepal")
  district         String
  cityVillage      String
  area             String
  ward             String?
  landmark         String?
  distanceFrom     String? // suggestions (swyambhunath, pashupatinath, fewataal, 0km, ringroad, bouddha, bhatbhateni)
}

model PropertyAmenity {
  id               Int      @id @default(autoincrement())
  propertyId       Int
  property         Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  
  type             String   // hospital, gym, park, pokhara, woda office, public transport, school, pharmacy, banquete, restaurant, hotel, atm, police station
  name             String?  
  distance         String?  
}

model PropertyPricing {
  id               Int      @id @default(autoincrement())
  propertyId       Int      @unique
  property         Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  
  negotiable       Boolean  @default(true)
  pricingType      String   // flat, perUnit
  unit             String?  // meterSquare, aana
  price            Float
  priceInWords     String?
  priceNegotiable  Float?
  priceNegotiableInWords String?
  rentPrice        Float?
}

model PropertyOpenHouse {
  id               Int      @id @default(autoincrement())
  propertyId       Int      @unique
  property         Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  
  markOpenHouse    Boolean  @default(false)
  date             DateTime?
  startTime        String?
  endTime          String?
  latitude         Float?
  longitude        Float?
}

model PropertyImage {
  id               Int      @id @default(autoincrement())
  propertyId       Int
  property         Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  
  url              String
  imageOf          String   // kitchen, bedroom, livingroom, etc.
  filename         String   // title of the property + image of + uniqueIdentifier
}

model PropertyVideo {
  id               Int      @id @default(autoincrement())
  propertyId       Int
  property         Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  
  url              String
  type             String   // YouTube Video, Instagram Reel, Facebook Reel, YouTube Shorts, Tiktok Shorts
}

model FeaturedInformation {
  id              Int       @id @default(autoincrement())
  property_id     Int
  property        Property  @relation(fields: [property_id], references: [id])
  is_active       Boolean   @default(true)
  featured_on     DateTime  @default(now())
  featured_till   DateTime?
}

model Comment {
  id          Int      @id @default(autoincrement())
  content     String
  created_at  DateTime @default(now())
  
  property_id Int
  property    Property @relation(fields: [property_id], references: [id])
  
  user_id     Int
  user        User     @relation(fields: [user_id], references: [id])
}

model Like {
  id          Int      @id @default(autoincrement())
  created_at  DateTime @default(now())
  
  property_id Int
  property    Property @relation(fields: [property_id], references: [id])
  
  user_id     Int
  user        User     @relation(fields: [user_id], references: [id])

  @@unique([property_id, user_id])
}

model Agency {
  id              Int      @id @default(autoincrement())
  name            String
  username        String   @unique
  profile_picture String?
  email           String?
  phone           String?
  bio             String?
  website         String?
  
  // Social Medias
  facebook        String?
  instagram       String?
  twitter         String?
  linkedin        String?
  
  // Status
  is_verified     Boolean  @default(false)
  
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt
}

model SystemSettings {
  id                      Int      @id @default(1)
  view_mode               String   @default("classic") // classic, social
  show_like_button        Boolean  @default(true)
  show_share_button       Boolean  @default(true)
  show_comment_button     Boolean  @default(true)
  show_contact_agent      Boolean  @default(true)
  show_make_offer         Boolean  @default(true)
  updated_at              DateTime @updatedAt
}

model Collection {
  id          Int        @id @default(autoincrement())
  name        String
  slug        String     @unique @default(cuid())
  description String?
  type        String     @default("user_generated") // user_generated, system_generated
  
  // For system generated collections, we store filter conditions here as JSON
  moreInfo    String?    // JSON string for conditions: { type, nature, purpose, priceMin, priceMax, unit, etc. }
  
  is_public   Boolean    @default(true)
  view_mode   String     @default("classic") // classic, social
  created_at  DateTime   @default(now())
  updated_at  DateTime   @updatedAt

  user_id     Int
  user        User       @relation(fields: [user_id], references: [id])

  properties  CollectionProperty[]
}

model CollectionProperty {
  id            Int        @id @default(autoincrement())
  collection_id Int
  collection    Collection @relation(fields: [collection_id], references: [id], onDelete: Cascade)
  
  property_id   Int
  property      Property   @relation(fields: [property_id], references: [id], onDelete: Cascade)

  added_at      DateTime   @default(now())

  @@unique([collection_id, property_id])
}


model Requirement {
  id                Int      @id @default(autoincrement())
  userId            Int?
  user              User?    @relation(fields: [userId], references: [id])
  
  mode              String   @default("simple") // simple, detailed
  content           String?  // For simple mode
  
  // Detailed Mode Fields
  propertyTypes     String?  // Comma separated list
  purposes          String?  // Comma separated list
  natures           String?  // Comma separated list
  facings           String?  // Comma separated list
  district          String?
  cityVillage       String?
  area              String?
  roadAccess        String?
  minPrice          Float?
  maxPrice          Float?
  pricingUnit       String?
  latitude          Float?
  longitude         Float?
  remarks           String?
  
  status            String   @default("active")
  created_at        DateTime @default(now())
  updated_at        DateTime @updatedAt
}

model Subscriber {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model SearchTerm {
  id            Int      @id @default(autoincrement())
  term          String   @unique
  count         Int      @default(1)
  last_searched DateTime @updatedAt
}
